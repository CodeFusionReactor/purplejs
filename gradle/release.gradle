task release {
    description = 'Release the this version by publishing artifacts.'
    dependsOn = ['clean', 'build']

    doFirst {
        if ( isSnapshot )
        {
            throw new GradleException( 'Cannot release SNAPSHOT version.' )
        }
    }
}

gradle.taskGraph.whenReady { graph ->
    if ( graph.hasTask( 'bintrayUpload' ) )
    {
        release.dependsOn += 'bintrayUpload';
    }

    if ( graph.hasTask( 'publishPlugins' ) )
    {
        release.dependsOn += 'publishPlugins';
    }
}
